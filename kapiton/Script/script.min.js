$.ajaxSetup({cache:false});var Kapiton={};Kapiton.Ajax={Cashe:{sectionCashe:[],loadSectionCashe:function(sec){var cashe=this.getCasheBySection(sec);$('#content').html(cashe[0].content)},sectionIsCashed:function(sec){if(this.sectionCashe.length==0)return false;var found=this.getCasheBySection(sec);if(found.length>=1)return true;return false},sectionIsCashedAndNew:function(sec){if(this.sectionCashe.length==0)return false;var found=this.getCasheBySection(sec);if(found.length>=1){var now=new Date();if(now-found[0].updated>=180000)return false;else return true}return false},getCasheBySection:function(sec){return $.grep(this.sectionCashe,function(e){return e.section==sec})},addSectionCashe:function(sec,data){var now=new Date();var old=this.getCasheBySection(sec);if(old.length>=1){this.sectionCashe=jQuery.grep(this.sectionCashe,function(e){return e.section!=old[0].section})}this.sectionCashe.push({section:sec,content:data,updated:now})}},getContent:function(sec){$('#content').html('Loading...');if(this.Cashe.sectionIsCashedAndNew(sec)&&navigator.onLine)this.Cashe.loadSectionCashe(sec);else if(navigator.onLine)this.Request('get','sec='+sec,'content',true,sec);else if(this.Cashe.sectionIsCashed(sec)){var cashe=Kapiton.Ajax.Cashe.getCasheBySection(sec);$('#content').html(cashe[0].content)}else $('#content').html('Cant find a internet-connection!')},saveContent:function(sec,param){if(navigator.onLine){$('#content').html('Saving...');this.Request('get','sec='+sec+'&a=save&'+param,'content',false,sec)}else alert('Cant do this action when offline!')},Request:function(reqType,param,goal,cashe,sec){var result=$.ajax({url:'Ajax/Ajax.php?'+param,type:reqType,dataType:'html',success:function(data){if(cashe){Kapiton.Ajax.Cashe.addSectionCashe(sec,data)}else{Kapiton.Ajax.Cashe.sectionCashe=[]}$('#'+goal).html(data)},error:function(jqXHR,textStatus,errorThrown){var cashe=Kapiton.Ajax.Cashe.getCasheBySection(sec);if(cashe.length>=1)$('#'+goal).html(cashe[0].content);else $('#'+goal).html('Error: '+jqXHR.status+'<br />Please try again at a later time!')}})}};window.addEventListener("offline",function(e){$('#netStatus').removeClass('netOnline');$('#netStatus').addClass("netOffline");$('#netStatus').html('Offline')},false);window.addEventListener("online",function(e){$('#netStatus').removeClass('netOffline');$('#netStatus').addClass("netOnline");$('#netStatus').html('Online')},false);$(document).on('click',"div.menuOpt",function(){if($(this).attr("class").indexOf("selectedOpt")<0){$(".selectedOpt").toggleClass("selectedOpt");$(this).toggleClass("selectedOpt");Kapiton.Ajax.getContent($(this).attr("id"))}});$(document).on('click',"#settingsSubmit",function(){Kapiton.Ajax.saveContent('settings','api='+$('#api').val()+'&cell='+$('#cell').val())});$(document).on('click',"#buyOrderSubmit",function(){Kapiton.Ajax.saveContent('buy','bc='+$('#bcOrder').val()+'&sek='+$('#sekOrder').val())});$(document).on('click',"#sellOrderSubmit",function(){Kapiton.Ajax.saveContent('sell','bc='+$('#bcOrder').val()+'&sek='+$('#sekOrder').val())});$(document).ready(function(){Kapiton.Ajax.getContent('overview')});